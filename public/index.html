<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medlemsansökan - Kajakklubben</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">

    <!-- Success Popup Modal -->
    <div id="successOverlay" class="success-overlay">
        <div class="success-modal">
            <h2>Tack!</h2>
            <p>
                Vi har tagit emot din ansökan och kommer att kontakta dig via e-post
                så snart vi gått igenom den.
            </p>
            <button id="successCloseBtn" type="button" class="btn success-close-btn">
                Stäng
            </button>
        </div>
    </div>

    <h1>Ansök om medlemskap</h1>

    <div class="admin-cta">
        <a class="btn btn-outline" href="admin.html">Adminportal</a>
        <!-- Vill du öppna i ny flik? Lägg till: target="_blank" rel="noopener" -->
    </div>

    <p>Fyll i formuläret nedan för att ansöka om medlemskap i klubben.</p>

    <form id="applyForm">
        <label for="name">Namn *</label>
        <input type="text" id="name" name="name" required>

        <label for="email">E-post *</label>
        <input type="email" id="email" name="email" required>

        <label for="phone">Telefon</label>
        <input type="tel" id="phone" name="phone">

        <label for="address">Adress</label>
        <input type="text" id="address" name="address">

        <label for="swimming">Är du simkunnig? *</label>
        <small>
            Enligt svenska riktlinjer anses man simkunnig om man kan simma minst
            <strong>200–250 meter</strong> i följd utan flythjälp.
        </small>
        <select id="swimming" name="swimming" required>
            <option value="">Välj...</option>
            <option value="Ja">Ja</option>
            <option value="Nej">Nej</option>
        </select>


        <label for="experience">Kajakerfarenhet *</label>
        <small>
            Osäker på vad du ska välja? Läs mer om nivåer och säkerhetskrav i
            <a href="https://kforesund.se/wp-content/uploads/2025/07/KFO_Handbok_3_5.pdf"
               target="_blank" rel="noopener">
                KFO:s handbok (avsnitt 3.5)
            </a>.
        </small>
        <select id="experience" name="experience" required>
            <option value="">Välj...</option>
            <option value="Grundkurs i havskajak">Grundkurs i havskajak</option>
            <option value="Annat (motsvarande kurs/erfarenhet – ange under Övrigt)">
                Annat (motsvarande kurs/erfarenhet – ange under "Övrigt")
            </option>
            <option value="Ingen">Ingen</option>
        </select>

        <label for="rescue">Kan du grundläggande räddningstekniker? *</label>
        <select id="rescue" name="rescue" required>
            <option value="">Välj...</option>
            <option value="Ja">Ja</option>
            <option value="Nej">Nej</option>
        </select>

        <label for="message">Övrigt</label>
        <textarea id="message" name="message"
                  placeholder='Till exempel om du valt "Annat" ovan – beskriv kort din utbildning/erfarenhet.'></textarea>

        <button type="submit">Skicka ansökan</button>
    </form>

</div>

<script>
    const API_BASE = "https://kfo-1.onrender.com";

    const form = document.getElementById("applyForm");
    const overlay = document.getElementById("successOverlay");
    const closeBtn = document.getElementById("successCloseBtn");

    // Stäng popupen när man klickar på "Stäng"
    if (closeBtn && overlay) {
      closeBtn.addEventListener("click", () => {
        overlay.style.display = "none";
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        name: form.name.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        address: form.address.value.trim(),
        swimming: form.swimming.value,
        experience: form.experience.value,
        rescue: form.rescue.value,
        message: form.message.value.trim()
      };

      try {
        const res = await fetch(`${API_BASE}/api/apply`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const json = await res.json();

        if (res.ok) {
          form.reset();
          // Visa popupen
          if (overlay) {
            overlay.style.display = "flex";
          }
          console.log("Ansökan inskickad, ID:", json.id);
        } else {
          alert(json.error || "Något gick fel.");
        }
      } catch (err) {
        alert("Kunde inte nå servern.");
        console.error(err);
      }
    });
</script>

</body>
</html>
